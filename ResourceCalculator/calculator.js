!function(e){"use strict";e(window).on("load",function(){function t(){var t=e("#item_filter").val().toLowerCase(),n=e("#unused_hide_checkbox").prop("checked");e("#content_field").find(".desired_item").each(function(){var r=e(this).attr("mc_value").toLowerCase(),o=e(this).find(".desired_item_count").val();-1===r.indexOf(t)||!(o>0)&&n?e(this).hide():e(this).show()})}function n(e){return null===e?"":e.toLowerCase().replace(/[^a-z0=9]/g,"")}function r(e){for(let t in e)if(e[t]<0)return!0;return!1}function o(){for(var t,n=(t={},e(".desired_item").each(function(){var n=e(this).attr("mc_value"),r=e(this).find(".desired_item_count").val();e.isNumeric(r)&&(t[n]=-r)}),t),o=JSON.parse(JSON.stringify(n)),d={},f={},h={};r(o);){var p=JSON.parse(JSON.stringify(o));for(let t in o)if(o[t]<0){var _=k(t).requirements,y=k(t).output,b=-o[t],x=Math.ceil(b/y);p[t]+=x*y,t in f||(f[t]=0),f[t]+=x*y,0===_[t]&&1===Object.keys(_).length?(void 0===h[t]&&(h[t]=0),h[t]+=x*y):e.each(_,function(e){void 0===p[e]&&(p[e]=0),p[e]+=_[e]*x;var n=t+e;n in d||(d[n]={source:e,target:t,value:0}),d[n].value+=_[e]*-x})}o=p}for(let e in n)"Raw Resource"===k(e).recipe_type&&(d[e+"final"]={source:e,target:"[Final] "+e,value:-n[e]});for(let e in p){if(p[e]>0)d[e+"extra"]={source:e,target:"[Extra] "+e,value:p[e]},f["[Extra] "+e]=p[e]}var T=JSON.parse(JSON.stringify(d));for(let e in T){var C=T[e].source;if(C in n)d[C+"final"]={source:C,target:"[Final] "+C,value:-n[C]},f["[Final] "+C]=-n[C]}!function(e,t){var n={top:10,right:1,bottom:10,left:1};g={};var r=800-n.top-n.bottom,o=function(e){var t=s(e),n=0;for(let e in t)t[e]+1>n&&(n=t[e]+1);var r=Array(n);for(let e=0;e<n;e++)r[e]=[];for(let e in t)r[t[e]].push(e);return r}(e),i={};for(let n in o)for(let r in o[n]){var a=o[n][r];i[a]={input:w(e,a),output:t[a],size:Math.max(t[a],w(e,a)),column:Number(n),passthrough:!1,incoming_edges:[],outgoing_edges:[]}}for(let t in e){let n=e[t];i[n.target].incoming_edges.push(t),i[n.source].outgoing_edges.push(t),n.target_column=i[n.target].column,n.source_column=i[n.source].column}for(let t in e){let n=e[t];n.passthrough_nodes=[];var d=n.source_column,f=n.target_column;for(let e=d+1;e<f;e+=1){var h=t+"_"+e;i[h]={size:n.value,passthrough_node_index:n.passthrough_nodes.length,passthrough_edge_id:t,column:e,passthrough:!0},n.passthrough_nodes.push(h),o[e].push(h)}}var p=9999;for(let e in o){var _=r+10,y=0;for(let t in o[e]){var b=i[o[e][t]];_-=10,y+=b.size}var x=_/y;p>x&&(p=x)}(function(e,t,n,r,o,i,a){for(let e in t){var s=0;for(let r in t[e]){var d=n[t[e][r]];d.height=d.size*o,d.y=s,s+=d.height+i}}for(let o=1;e>0;--e)c(o*=.99,t,n,r),u(o,t,n,r),l(t,n,i,a)})(32,o,i,e,p,10,r),function(e,t,n,r,o,i){v={columns:e,nodes:t,edges:n,height:r,value_scale:o,margin:i},m()}(o,i,e,r,p,n)}(d,f),function(t,n){var r=s(t),o=e("<div/>"),u=0;e("<div/>").attr("id","text_instructions_title").text("Base Ingredients").appendTo(o);for(let t in r){if(0===r[t]){var c=e("<div/>");c.addClass("instruction_wrapper"),a(n[t],t).appendTo(c),c.appendTo(o)}r[t]>=u&&(u=r[t]+1)}e("<div/>").attr("id","text_instructions_title").text("Text Instructions [Beta]").appendTo(o);for(let a=1;a<u;a++){for(let e in r)if(r[e]===a){if(e.startsWith("[Final]")||e.startsWith("[Extra]"))continue;i(t,e,n).appendTo(o)}var d=e("<div/>");d.addClass("instruction_line_break"),d.appendTo(o)}var l=document.getElementById("text_instructions");for(;l.firstChild;)l.removeChild(l.firstChild);o.appendTo(e("#text_instructions"))}(d,f)}function i(e,t,n){var r={};for(let n in e)e[n].target===t&&(r[e[n].source]=e[n].value);var o=k(t).recipe_type;return recipe_type_functions[o](r,t,n[t],a)}function a(t,n){var r=e("<div/>");r.addClass("instruction_item");var o=e("input[name=unit_name]:checked").val();if(""!==o&&void 0!==o){var i=function e(t,n){if(0===t)return[];if(null===n)return[{name:null,count:t}];var r=stack_sizes[n],o=r.quantity_multiplier,i=Math.floor(t/o),a=t%o,s=[];if(i>0){var u={};u.name=i>1?r.plural:n,u.count=i,s=[u]}return s=s.concat(e(a,r.extends_from))}(t,o);let n=e("<div/>");n.addClass("instruction_item_count");var a="";for(let t=0;t<i.length;t++)e("<span/>").text(a+i[t].count).appendTo(n),null!==i[t].name&&e("<span/>").text("("+i[t].name+")").addClass("small_unit_name").appendTo(n),a="+";n.appendTo(r)}else{let n=e("<div/>");n.addClass("instruction_item_count"),n.text(t),n.appendTo(r)}var s=e("<span/>");s.text(" "),s.appendTo(r);var u=e("<div/>");return u.addClass("instruction_item_name"),u.text(n),u.appendTo(r),r}function s(e){var t=[];for(let n in e)-1===t.indexOf(e[n].source)&&t.push(e[n].source),-1===t.indexOf(e[n].target)&&t.push(e[n].target);var n={},r={};function o(t){if(!(t in n)){n[t]=0;for(let r in e)e[r].source===t&&(o(e[r].target),n[e[r].target]+1>n[t]&&(n[t]=n[e[r].target]+1))}}function i(t){if(!(t in r)){r[t]=0;for(let n in e)e[n].target===t&&(i(e[n].source),r[e[n].source]+1>r[t]&&(r[t]=r[e[n].source]+1))}}for(let e in t)o(t[e]),i(t[e]);var a=0;for(let e in r)r[e]>a&&(a=r[e]);for(let e in n)0===n[e]&&(r[e]=a);return r}function u(e,t,n,r){function o(e){var t=0;if(!1===e.passthrough)for(let a in e.incoming_edges){var o=r[e.incoming_edges[a]],i=n[o.source];o.passthrough_nodes.length&&(i=n[o.passthrough_nodes[o.passthrough_nodes.length-1]]),t+=d(i)*o.value}else{var a=r[e.passthrough_edge_id];t=0===e.passthrough_node_index?d(n[a.source])*a.value:d(n[a.passthrough_nodes[e.passthrough_node_index-1]])*a.value}return t}function i(e){if(!1===e.passthrough){var t=0;for(let n in e.incoming_edges)t+=r[e.incoming_edges[n]].value;return t}return e.size}for(let r in t)if(0!==Number(r))for(let u in t[r]){var a=n[t[r][u]],s=o(a)/i(a);a.y+=(s-d(a))*e}}function c(e,t,n,r){function o(e){var t=0;if(!1===e.passthrough)for(let a in e.outgoing_edges){var o=r[e.outgoing_edges[a]],i=n[o.target];o.passthrough_nodes.length&&(i=n[o.passthrough_nodes[0]]),t+=d(i)*o.value}else{var a=r[e.passthrough_edge_id];t=e.passthrough_node_index===a.passthrough_nodes.length-1?d(n[a.target])*a.value:d(n[a.passthrough_nodes[e.passthrough_node_index+1]])*a.value}return t}function i(e){if(!1===e.passthrough){var t=0;for(let n in e.outgoing_edges)t+=r[e.outgoing_edges[n]].value;return t}return e.size}t=t.slice().reverse();for(let r in t)if(0!==Number(r))for(let u in t[r]){var a=n[t[r][u]],s=o(a)/i(a);a.y+=(s-d(a))*e}}function d(e){return e.y+e.height/2}function l(e,t,n,r){function o(e,n){return t[e].y-t[n].y}for(let u in e){var i=e[u];i.sort(o);var a=0;for(let e=0;e<i.length;e++){let r=t[i[e]],o=a-r.y;o>0&&(r.y+=o),a=r.y+r.height+n}var s=r;for(let e=i.length-1;e>=0;e--){let r=t[i[e]],o=s-(r.y+r.height);o<0&&(r.y+=o),s=r.y-n}}}function f(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function h(e){return"rgb("+e.r+","+e.g+","+e.b+")"}e("#reset_item_count").click(function(){e(".desired_item").each(function(){var t=e(this).find(".desired_item_count");t.val(""),C(t)}),e("#unused_hide_checkbox").prop("checked"),e("#unused_hide_checkbox").prop("checked",!1).change(),o()}),e("#about_button").click(function(){e("#about_us").slideToggle()}),e("input[name=unit_name]").click(function(){o()}),e(".desired_item").each(function(){var t=e(this),r=t.find(".desired_item_count");t.click(function(){r.focus()}),r.bind("propertychange change click keyup input paste",function(){var t;t={},e(".desired_item").each(function(){var n=e(this).find(".desired_item_count").attr("id"),r=e(this).find(".desired_item_count").val();e.isNumeric(r)&&(t[n]=r)}),history.pushState?history.pushState(null,null,"#"+e.param(t)):window.location.hash=e.param(t)}),r.focus(function(){t.addClass("desired_item_input_focused")}),r.blur(function(){t.removeClass("desired_item_input_focused")}),t.dblclick(function(r){!function(t,r){var o=e("#recipe_select"),i=e("#recipe_selector_list");i.empty();for(let r in recipe_json[t]){var a=e("<div/>");a.addClass("recipe_select_item"),a.click(function(e){return function(){b(t,e),T(t),o.css("opacity",0),o.css("pointer-events","none")}}(r));var s=e("<div/>").addClass("recipe_select_item_name").text(recipe_json[t][r].recipe_type);for(let o in recipe_json[t][r].requirements)!function(o){var i=-recipe_json[t][r].requirements[o],a=e("<div/>").addClass("required_item").addClass("item").addClass("item_"+n(o)).text(i).appendTo(s);a.mouseover(function(){e("#hover_name").text(i+"x "+o),e("#hover_name").css("opacity",1)}),a.mouseout(function(){e("#hover_name").css("opacity",0)})}(o);s.appendTo(a),e("<div/>").addClass("clear").appendTo(a),a.appendTo(i)}o.css("opacity",1),o.css("pointer-events","auto");var u=r.pageX+-10,c=r.pageY+-10;e(window).width()<o.outerWidth()+r.pageX+-10&&(u=r.pageX- -10-o.outerWidth());e(window).height()+e(document).scrollTop()<o.outerHeight()+r.pageY+-10&&(c=r.pageY- -10-o.outerHeight());o.offset({left:u,top:c})}(t.attr("mc_value"),r)}),t.mouseover(function(){e("#hover_name").text(t.attr("mc_value")),e("#hover_name").css("opacity",1)}),t.mouseout(function(){e("#hover_name").css("opacity",0)})}),e("#item_filter").bind("propertychange change click keyup input paste",function(){t()}),e("#unused_hide_checkbox").change(function(){e(this).prop("checked")?e("label[for='"+e(this).attr("id")+"']").text("Show Unused"):e("label[for='"+e(this).attr("id")+"']").text("Hide Unused"),t()}),e("#generatelist").click(o);var p=[f("1f77b4"),f("aec7e8"),f("ff7f0e"),f("ffbb78"),f("2ca02c"),f("98df8a"),f("d62728"),f("ff9896"),f("9467bd"),f("c5b0d5"),f("8c564b"),f("c49c94"),f("e377c2"),f("f7b6d2"),f("bcbd22"),f("dbdb8d"),f("17becf"),f("9edae5"),f("7f7f7f"),f("c7c7c7")],g={};function _(e){e=(e=(e=e.replace(/^\[Extra\] /,"")).replace(/^\[Final\] /,"")).replace(/ .*/,"");var t=g[e];return void 0===t&&(t=Object.keys(g).length%p.length,g[e]=t),p[t]}var v={};function m(){if(0!==Object.keys(v).length){var t=v.columns,n=v.nodes,r=v.edges,o=v.height,i=v.value_scale,a=v.margin,s=e("#content").width()-a.left-a.right,u=(s-20)/(t.length-1);e("#chart").empty();var c,d=e(document.createElementNS("http://www.w3.org/2000/svg","svg")),l=e(document.createElementNS("http://www.w3.org/2000/svg","g")).attr("transform","translate("+a.left+","+a.top+")").appendTo(d),f=e(document.createElementNS("http://www.w3.org/2000/svg","g")).appendTo(l),p=e(document.createElementNS("http://www.w3.org/2000/svg","g")).appendTo(l);for(let r in t){var g=u*r;for(let o in t[r]){var m=t[r][o];let a=n[m];if(!a.passthrough){var w=a.input*i,y=a.size*i,b=a.output*i;0===Number(r)&&(w=y);let n="M 0,0 L 0,"+w+" "+20/3+","+w+" "+20/3+","+y+" "+40/3+","+y+" "+40/3+","+b+" 20,"+b+" 20,0 Z",o=e(document.createElementNS("http://www.w3.org/2000/svg","g")).attr("transform","translate("+g+","+a.y+")").attr("class","node");var x=_(m),k=(c=x,{r:Math.round(.49*c.r),g:Math.round(.49*c.g),b:Math.round(.49*c.b)});e(document.createElementNS("http://www.w3.org/2000/svg","path")).attr("d",n).attr("style","fill: "+h(x)+"; stroke: "+h(k)+";").appendTo(o);var T=26,C="start";r>=t.length/2&&(T=-6,C="end"),e(document.createElementNS("http://www.w3.org/2000/svg","text")).attr("x",T).attr("y",y/2).attr("dy",".35em").attr("text-anchor",C).text(m).appendTo(o),o.appendTo(p)}}}for(let e in n){let t=n[e];if(!1===t.passthrough){t.incoming_edges.sort(L),t.outgoing_edges.sort(H);var N=0;for(let e in t.incoming_edges){let n=r[t.incoming_edges[e]];n.target_y_offset=N,N+=n.value*i}N=0;for(let e in t.outgoing_edges){let n=r[t.outgoing_edges[e]];n.source_y_offset=N,N+=n.value*i}}}for(let t in r){var S=r[t],E=S.value*i;let o=e(document.createElementNS("http://www.w3.org/2000/svg","g")).attr("transform","translate(0,0)");var O=n[r[t].source],j=n[r[t].target],z=(u-20)/2,R=O.column*u+20,I=O.y+S.source_y_offset+E/2;let a="M"+R+","+I+"C"+(R+z)+","+I+" ";for(let e in r[t].passthrough_nodes){var M=n[r[t].passthrough_nodes[e]],q=M.column*u,F=M.y+E/2;a+=q-z+","+F+" "+q+","+F+"C"+(q+z)+","+F+" "}var J=j.column*u,W=j.y+S.target_y_offset+E/2;a+=J-z+","+W+" "+J+","+W,e(document.createElementNS("http://www.w3.org/2000/svg","path")).attr("d",a).attr("style","stroke-width: "+E+"px;").attr("class","link").appendTo(o),o.appendTo(f)}var X=s+a.left+a.right,U=o+a.top+a.bottom;d.appendTo(e("#chart")).attr("width",X).attr("height",U)}function Y(e){var t=r[e];return t.passthrough_nodes.length>0?n[t.passthrough_nodes[t.passthrough_nodes.length-1]].y:n[t.source].y}function L(e,t){return Y(e)-Y(t)}function B(e){var t=r[e];return t.passthrough_nodes.length>0?n[t.passthrough_nodes[0]].y:n[t.target].y}function H(e,t){return B(e)-B(t)}}function w(e,t){var n=0;for(let r in e)e[r].target===t&&(n+=e[r].value);return n}window.onresize=function(){m()};e(document).on("mousemove",function(t){e(window).width()>e("#hover_name").outerWidth()+t.pageX+10?e("#hover_name").offset({left:t.pageX+10,top:t.pageY+-10}):e("#hover_name").offset({left:t.pageX-10-e("#hover_name").outerWidth(),top:t.pageY+-10})}),e("#recipe_select").mouseleave(function(){e("#recipe_select").css("opacity",0),e("#recipe_select").css("pointer-events","none")});var y={};function b(e,t){y[e]=t,0===t&&delete y[e]}function x(e){for(let t in recipe_json[e])if("Raw Resource"===recipe_json[e][t].recipe_type)return void b(e,t);alert("ERROR: Failed to set raw resource for "+e)}function k(e){return recipe_json[e][function(e){return e in y?y[e]:0}(e)]}function T(e){var t={};for(let e in recipe_json){t[e]=[];for(let n in k(e).requirements)-k(e).requirements[n]>0&&t[e].push(n)}var n=function e(t,n,r){var o=[];for(let i in t[n]){if(t[n][i]===r)return x(n),[n];o=o.concat(e(t,t[n][i],r))}return o}(t,e,e);for(let e in n)console.warn("Changing",n[e],"to raw resource to avoid infinite loop")}function C(t){""===e(t).val()?e(t).css("background-color","rgba(0,0,0,0)"):e(t).css("background-color","rgba(0,0,0,.5)")}e(".desired_item_count").focus(function(){e(this).css("background-color","rgba(0,0,0,.5)"),e(this).select()}),e(".desired_item_count").blur(function(){C(this)}),function(){var t=decodeURIComponent(window.location.hash.substr(1));if(""!==t){var n=t.split("&");for(let t in n){var r=n[t].split("="),i=decodeURIComponent(r[0]),a=decodeURIComponent(r[1]);e("#"+i).val(a),C(e("#"+i))}e("#unused_hide_checkbox").prop("checked",!0).change(),o()}e("#unused_hide_checkbox").change()}()})}(jQuery);